{
  "hash": "eed1aa38419646956de9f4675ab0e718",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"10-Nonlinear Regression\"\ndate: '2024-01-24'\n---\n\n\n\n\n# Introduction\n\nThe following examples demonstrate how to perform non-linear regression in R. \nThis is quite different from linear regression, not only because the regression functions\nshow a curve, but also due to the applied numerical techniques. While in the\nlinear case, the coefficients of the regression line can be calculated directly (analytically)\nby solving a linear system of equations, iterative numerical optimization needs to be used instead. \n\nThis means that the coefficients are approximated step by step until convergence, \nbeginning with start values specified  by the user. There is no guarantee that \nan optimal solution can be found.\n\nThe following examples are intended as a starting point, the last example \n(logistic growth) is left as an exercise.\n\n## Exponential growth\n\nThe first example shows an exponentially growing data set that is fitted by \nnonlinear least squares (`nls`). Here, the exponential function is given \ndirectly at the right hand side of the formula and the start values for the parameters\nare specified in `pstart`. An optional argument `trace = TRUE` is set\nto watch the progress of iteration.\n\nFunction `predict` can be used to create dense $x$ and $y$-values \n(here: `x1` and `y1`) for a smooth curve.\n\nThe statistical results of the regression are displayed with `summary`:\nparameters ($a$, $b$) of the curve, standard errors and the correlation between \n$a$ and $b$. Note the optional `correlation=TRUE` argument. \nHigh correlations can indicate problems in model fitting, especially due to\nso called non-identifiablility of the parameter set.\n\nHere everything went through even with high correlation, because the data\ndo not vary much around the exponential curve.\n\nFinally, the nonlinear coefficient of determination $R^2$ can be calculated \nfrom the variances of the residuals and the original data:\n\n\n::: {.cell fig='false'}\n\n```{.r .cell-code}\nx <- 1:10\ny <- c(1.6, 1.8, 2.1, 2.8, 3.5, 4.1, 5.1, 5.8, 7.1, 9.0)\nplot(x, y)\n\npstart <- c(a = 1, b = 1)\nmodel_fit <- nls(y ~ a * exp(b * x), start = pstart, trace = TRUE)\nx1 <- seq(1, 10, 0.1)\ny1 <- predict(model_fit, data.frame(x = x1))\nlines(x1, y1, col = \"red\")\n\nsummary(model_fit, correlation = TRUE)\n\n## R squared\n1 - var(residuals(model_fit))/var(y)\n```\n:::\n\n\n## Regression model as user-defined function\n\nInstead of putting the regression model directly into `nls` it is also \npossible to use a user-defined function, that we call `f` here for example. \nThis approach is especially useful for more complicated regression\nmodels:\n\n\n::: {.cell fig='false'}\n\n```{.r .cell-code}\nf <- function(x, a, b) {a * exp(b * x)}\n\nplot(x, y)\n\npstart <- c(a = 1, b = 1)\nmodel_fit <- nls(y ~ f(x, a, b), start = pstart)\n\nx1 <- seq(1, 10, 0.1)\ny1 <- predict(model_fit, data.frame(x = x1))\nlines(x1, y1, col = \"red\")\nsummary(model_fit, correlation = TRUE)\n1 - var(residuals(model_fit))/var(y)\n```\n:::\n\n\n\n# Michaelis-Menten kinetics\n\nThe following data from an experiment show the dependency of carbon uptake \nby micro-organisms on substrate concentration:\n\n\n::: {.cell fig='false'}\n\n```{.r .cell-code}\n# Substrate ug C /l\nS  <- c(25, 25, 10, 10, 5, 5, 2.5, 2.5, 1.25, 1.25)\n# Microbial uptake rate ug C /(l*h)\nV <- c(0.0998, 0.0948, 0.076, 0.0724, 0.0557,\n        0.0575, 0.0399, 0.0381, 0.017, 0.0253)\nplot(S, V)\n```\n:::\n\n\nThe plot shows a typical saturation at high substrate concentrations \nand the most common function used for such dependencies is the Michaelis-Menten kinetics,\nsometimes also called Monod function.\n\n\n::: {.cell fig='false'}\n\n```{.r .cell-code}\n## Michaelis-Menten kinetics \nf <- function(S, Vm, K) {\n Vm * S/(K + S)\n}\n```\n:::\n\n\nFitting the Michaelis-Menten function is essentially similar to the former example:\n\n\n::: {.cell fig='false'}\n\n```{.r .cell-code}\npstart <- c(Vm = max(V), K = 5)\nmodel_fit   <- nls(V ~ f(S, Vm, K), start = pstart, trace = TRUE)\nplot(S, V, xlim = c(0, 25), ylim = c(0, 0.1))\nx1 <- seq(0, 25, length = 100)\nlines(x1, predict(model_fit, data.frame(S = x1)), col = \"red\")\nsummary(model_fit)\n(Rsquared <- 1 - var(residuals(model_fit))/var(V))\n```\n:::\n\n\n..., but especially for Michaelis-Menten, **R** contains also a so-called \"self-start\"\n function, so that it is not necessary to define an own \"f\" and, even more useful,\n not necessary to provide start values for the parameters:\n\n\n\n::: {.cell fig='false'}\n\n```{.r .cell-code}\nmodel_fit <- nls(V ~ SSmicmen(S, Vm, K), trace = TRUE)\nplot(S, V, xlim = c(0, 25), ylim = c(0, 0.1))\nx1 <- seq(0, 25, length = 100)\nlines(x1, predict(model_fit, data.frame(S = x1)), col = \"red\")\nsummary(model_fit)\n(Rsquared <- 1 - var(residuals(model_fit))/var(V))\n```\n:::\n\n\n# Logistic growth of a cyanobacteria population\n\nThe following data describe the growth of a blue-green algae culture in a batch\nculture experiment:\n \n\n::: {.cell fig='false'}\n\n```{.r .cell-code}\n# time (t)\nx <- c(0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20)\n\n# Algae cell counts (per ml)\ny <- c(0.88, 1.02, 1.43, 2.79, 4.61, 7.12,\n       6.47, 8.16, 7.28, 5.67, 6.91) * 1e6\nplot(x, y)       \n```\n:::\n\n\nThe growth is exponential in the beginning and then approaches a saturation. \nThe points show a sigmoid shape and the usual function applied for this type\nof growth is the ``logistic equation'', with two parameters $r$ (maximum growth rate)\nand $K$ (carrying capacity). This is the function after which the $r$ and $K$ strategiests are\nnamed in ecology.\n\nThe following example shows the general behavior of the logistic and the formula \nin R notation:\n\n\n\n::: {.cell fig='false'}\n\n```{.r .cell-code}\nN0 <- 10\nr  <- 0.9\nK  <- 200\ntime <- seq(0, 10, length=101)\nplot(time, K /(1 + (K/N0 - 1) * exp(-r * time)), type=\"l\")\n```\n\n::: {.cell-output-display}\n![](10-nonlinear-regression_files/figure-html/curve2-1.png){width=672}\n:::\n:::\n\n\n# Exercise\n\nFit a logistic curve to the cell counts of the growth experiment. Note however, \nthat the large cell counts ($10^6$) can lead to numerical errors. Here it may be\nneccessary to adapt the `control` options of `nls` or, much simpler, to rescale\nthe `y`-variable to more convenient values.\n",
    "supporting": [
      "10-nonlinear-regression_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}