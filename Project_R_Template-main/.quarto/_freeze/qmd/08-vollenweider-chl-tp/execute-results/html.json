{
  "hash": "cca5075cb85414eaf8a7cd45b85dbd62",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"08-Linear Regression: Dependency of Chlorophyll on Phosphorus in Lakes\"\ndate: '2024-12-11'\n---\n\n\n\n\n# Introduction\n\nThe following example is based on the classical OECD study on\n\"Eutrophication of Inland Waters\" from @Vollenweider1980, that,\namong others, describes the relationship between annual mean\nchlorophyll concentration and annual mean total phosphorus in lakes.\nA website about aspects of this study can be found on\n[https://www.chebucto.ns.ca/ccn/info/Science/SWCS/TPMODELS/OECD/oecd.html](https://www.chebucto.ns.ca/ccn/info/Science/SWCS/TPMODELS/OECD/oecd.html).\n\nWe use a data set that was taken manually from the figure below. It is\nof course not exactly the original data set, but should be sufficient\nfor our purpose.\n\n<!--\nThe analysis is performed using \nthe R Language of statistical computing [@RCore] and the RStudio IDE [@RStudio].\n-->\n\n![Dependency of chlorophyll a on total phosphorus (Reproduced Figure 6.1 from Vollenweider and Kerekes 1980)](../img/vollenweider-chl-tp.png){width=40%}\n\n\n\nThis data set contains annual average concentrations of total\nphosphorus (TP, $\\mathrm{\\mu g L^{-1}}$) and chlorophyll a (CHLa,\n$\\mathrm{\\mu g L^{-1}}$) of 92 lakes.  A few points were overlapping\non the original figure, so that 2 lakes are missing.\n\n## Methods\n\nDownload `oecd.csv` from the course web[^oecd_data] page and copy it to a suitable\nfolder. The first row contains the variable names (`header=TRUE`) and\ndon't forget to set the working directory to the correct location:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- read.csv(\"oecd.csv\")\n```\n:::\n\n\nNow, inspect the data set in RStudio. The columns contain an ID number\n(No), phosphorus (TP) and chlorophyll (CHLa) concentration and a last\ncolumn indicating the limitation type of the lake: P: phosphorus\nlimitation, N: nitrogen limitation and I: light limitation.\n\n## Correlation coefficient\n\nFirst we want to know how much chlorophyll and phosphorus depend on\neach other.  For this purpose, we calculate the Pearson and Spearman\ncorrelations and test it for significance:\n\n\n::: {.cell fig='false'}\n\n```{.r .cell-code}\nplot(dat$TP, dat$CHLa)\ncor.test(dat$TP, dat$CHLa)\ncor.test(dat$TP, dat$CHLa, method=\"spearman\")\ncor.test(rank(dat$TP), rank(dat$CHLa))\n```\n:::\n\n\nCompare the values and discuss the results. The last line is just an\nalternative way to estimate **Spearman** correlation if ties (several\ntimes the same value) occur.\n\n## Linear Regression\n\n\nNow lets fit a linear regression (`lm` means linear model) and save\nthe result into a new object `reg`. This object can now be used to\nplot the regression line (`abline`) or to extract regression\nstatistics (`summary`):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(dat$TP, dat$CHL)\nreg <- lm(dat$CHLa ~ dat$TP)\nabline(reg)\nsummary(reg)\n```\n:::\n\n\n# Exercise\n\n## Repeat the analysis with log transformed data\n\nThe results indicate that one of the most important pre-requisites of\nlinear regression, namely \"variance homogeneity\" was violated. This\ncan be seen from the fan-shaped pattern where most of the data points\nare found in the lower left corner. A logarithmic transformation of\nboth variables can help here, so we should repeat the analysis with\nthe logarithms of TP and CHLa.\n\n\n\n\n::: {.cell fig='false'}\n\n```{.r .cell-code}\nx <- log(dat$TP)\ny <- log(dat$CHLa)\nplot(x, y)\nreg <- lm(y ~x)\nabline(reg)\nsummary(reg)\n```\n:::\n\n\n## Confidence intervals\n\nConfidence and prediction intervals are useful to demonstrate\nuncertainty of the regression line and for predictions. The following\ncode shows an example with test data.\n\n\n::: {.cell fig='true'}\n\n```{.r .cell-code}\nx <- 1:10\ny <- 2 + 3 * x + rnorm(10, sd=2)\nplot(x, y)\nreg <- lm(y ~ x)\n\nnewdata <- data.frame(x=seq(min(x), max(x), length=100))\nconflim <- predict(reg, newdata=newdata, interval=\"confidence\")\npredlim <- predict(reg, newdata=newdata, interval=\"prediction\")\nlines(newdata$x, conflim[,2], col=\"blue\", lty=\"dashed\") \nlines(newdata$x, conflim[,3], col=\"blue\", lty=\"dashed\")\nlines(newdata$x, predlim[,2], col=\"red\", lty=\"solid\") \nlines(newdata$x, predlim[,3], col=\"red\", lty=\"solid\")\n\nabline(reg)\n```\n\n::: {.cell-output-display}\n![](08-vollenweider-chl-tp_files/figure-html/linear-with-conflimits-1.png){width=52%}\n:::\n:::\n\n\nThe result of `predict` is a matrix with 3 columns:\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n       fit      lwr      upr\n1 4.785678 1.334451 8.236906\n2 5.052683 1.650848 8.454519\n3 5.319688 1.966943 8.672434\n```\n\n\n:::\n:::\n\n\n* the first column contains the fit,\n* the second and 3rd column the confidence resp. prediction intervals. \n\nYou can also find this out yourself by reading the documentation (`?predict`) or by \ninspecting `conflim` and `predlim` in the RStudio object explorer.\n\n\nThe data frame `newdata` contains $x$ values for the prediction. Please note\nthat the variable name (e.g. `x` or `log_TP`) must be exactly the same as in the `lm`-function!\n\n# Tasks\n\n## Course task\n\nCombine your solution for the log-transformed chlorophyll-phosphorus\nregression with the confidence interval example, to reproduce the\nappearance of OECD Figure.  Discuss the results.\n\n\n## Self study\n\n1. Inform yourself about the background of eutrophication, the\n  classical OECD study [@Vollenweider1980] and recent developments.\n  Read Section 6 and 6.1 of the OECD report and find additional\n  references.\n\n2. Discuss the results of the Exercises above and back-transform the\n  double logarithmic equation to linear scale using the **laws of\n  logs** on a sheet of paper:\n\n\\begin{align}\n    \\log(y) & = a + b \\log(x) \\\\\n    y       & = \\dots\n\\end{align}\n\n3. Compare the equation with the equation in Figure 6.1. of the OECD\n  report.\n\n4. Repeat the analysis for the P-limited data only: add confidence\n  intervals, back-transform the equation and compare it with the\n  equation in Fig. 6.1 of the report\n\n5. Optional: The axes of the own plots are log-transformed, and the\n  annotations show the log.  This is not easy to read. Find a way to\n  annotate the axes with the original (not log-transformed) values as\n  in the original report and add grid lines.\n\nNote: if you need help, contact your learning team members or ask in\nthe matrix chat.\n\n## Notes\n\n\n**Difference between corelation and regression**\n\n* **correlation** measures whether a linear or monotonous dependency\n    exists\n\n* **regression** describes the relationship with a mathematical model\n\n\n**Example how to use a subset**\n\n\nWe can create a plot with different plotting symbols, by making the\nplotting character `pch` dependent on the limitation type\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(dat$TP, dat$CHL, pch = dat$Limitation)\n```\n:::\n\n\nAnother method using plotting symbols employs conversion from\ncharacter to a factor and then to a numeric:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(dat$TP, dat$CHL, pch = as.numeric(factor(dat$Limitation)))\n```\n:::\n\n\nThe following shows one approach for subsetting direcly in the\n`lm`-function.  It is of course also possible to use a separate\n`subset` function before calling `lm`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nreg <- lm(CHLa ~ TP, data = dat, subset = (Limitation == \"P\"))\n# ...\n```\n:::\n\n\n[^oecd_data]: The data set is available from [https://tpetzoldt.github.io/datasets/data/oecd.csv](https://tpetzoldt.github.io/datasets/data/oecd.csv). Students of TU Dresden find it also in the OPAL learning management system.\n\n**References**\n\n<small>\n<div id=\"refs\"></div>\n</small>\n",
    "supporting": [
      "08-vollenweider-chl-tp_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}